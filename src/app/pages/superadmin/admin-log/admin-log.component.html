<div class="header">
  <h2>ðŸ“Š Historial de Sesiones</h2>
</div>

<!-- ðŸ”¥ NUEVO: Panel de controles y estadÃ­sticas -->
<div class="controls-panel">
  <div class="stats-container">
    <div class="stat-card">
      <span class="stat-number">{{ getEstadisticas().total }}</span>
      <span class="stat-label">Total Sesiones</span>
    </div>
    <div class="stat-card">
      <span class="stat-number" [style.color]="'#22c55e'">{{ getEstadisticas().activas }}</span>
      <span class="stat-label">Activas</span>
    </div>
    <div class="stat-card">
      <span class="stat-number" [style.color]="'#3b82f6'">{{ getEstadisticas().finalizadas }}</span>
      <span class="stat-label">Finalizadas</span>
    </div>
    <div class="stat-card">
      <span class="stat-number" [style.color]="'#f59e0b'">{{ getEstadisticas().problematicas }}</span>
      <span class="stat-label">Por revisar</span>
    </div>
  </div>

  <div class="actions-container">
    <button 
      pButton 
      icon="pi pi-refresh" 
      label="Actualizar" 
      class="p-button-info"
      (click)="recargarHistorial()"
      [disabled]="loading">
    </button>
    
    <button 
      pButton 
      icon="pi pi-filter" 
      label="Ocultar antiguas" 
      class="p-button-secondary"
      (click)="limpiarVistaSesionesAntiguas()">
    </button>
  </div>
</div>

<div class="table-container">
  <p-table 
    [value]="logs" 
    [paginator]="true" 
    [rows]="rowsPerPage"
    [first]="first" 
    (onPageChange)="onPageChange($event)" 
    [loading]="loading" 
    responsiveLayout="scroll"
    styleClass="p-datatable-striped">

    <ng-template pTemplate="header">
      <tr>
        <th>ID Usuario</th>
        <th>Fecha/Hora de Entrada</th>
        <th>Fecha/Hora de Salida</th>
        <th>Estado</th>
        <th>DuraciÃ³n</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-log>
      <tr>
        <td>{{ log.usuario_id }}</td>
        <td>{{ log.login_time_display }}</td>
        <td>{{ log.logout_time_display }}</td>
        <td>
          <p-tag 
            [value]="log.estado" 
            [severity]="log.severidad"
            [pTooltip]="log.tooltip"
            tooltipPosition="top">
          </p-tag>
        </td>
        <td>
          <span *ngIf="log.logout_time">
            {{ calcularDuracion(log.login_time, log.logout_time) }}
          </span>
          <span *ngIf="!log.logout_time" class="duracion-activa">
            {{ log.horasDesdeLogin.toFixed(1) }} h
          </span>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="loadingbody">
      <tr>
        <td colspan="5" class="loading-message">
          Cargando historial de sesiones...
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="empty-message">
          No hay registros de sesiones
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p *ngIf="statusMessage" class="status">{{ statusMessage }}</p>
</div>