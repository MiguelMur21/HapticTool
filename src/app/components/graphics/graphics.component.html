<div class="graphics-container">
  <h2 class="title">Visualizador de Datos 3D</h2>
  <p class="subtitle">Selecciona un archivo de datos para visualizar los puntos 3D</p>

  <div class="form-section">
    <label for="archivo">Archivo:</label>
    <select id="archivo" [(ngModel)]="nombreArchivo">
      <option value="">Selecciona un archivo...</option>
      <option *ngFor="let archivo of archivos" [value]="archivo">{{ archivo }}</option>
    </select>
  </div>

  <div class="button-group">
    <button pButton type="button" label="Generar grafica" icon="pi pi-upload" 
            class="p-button-info" (click)="cargarArchivo()"></button>
  </div>

  <!-- CONTROLES DE ANIMACI√ìN - SIEMPRE VISIBLES CUANDO HAY DATOS -->
  <div class="animation-controls" *ngIf="frames.length > 0">
    <div class="controls-row">
      <button pButton type="button" icon="pi pi-step-backward" 
              class="p-button-secondary" (click)="previousFrame()"
              [disabled]="currentFrameIndex === 0"></button>
      
      <button pButton type="button" [icon]="isAnimating ? 'pi pi-pause' : 'pi pi-play'" 
              [class]="isAnimating ? 'p-button-warning' : 'p-button-success'" 
              (click)="toggleAnimation()"></button>
      
      <button pButton type="button" icon="pi pi-step-forward" 
              class="p-button-secondary" (click)="nextFrame()"
              [disabled]="currentFrameIndex === frames.length - 1"></button>
      
      <button pButton type="button" label="Reset" icon="pi pi-refresh" 
              class="p-button-help" (click)="resetAnimation()"></button>
    </div>

    <!-- BARRA DE PROGRESO -->
    <div class="progress-section">
      <div class="frame-info">
        <span>Frame: {{ currentFrameIndex + 1 }} / {{ frames.length }}</span>
        <span>Tiempo: {{ getCurrentTime() }}</span>
      </div>
      
      <div class="progress-bar-container">
        <input type="range" 
               min="0" 
               [max]="frames.length - 1" 
               [value]="currentFrameIndex"
               (input)="onFrameSeek($event)"
               class="progress-slider">
        <div class="progress-labels">
          <span>0s</span>
          <span>{{ getTotalTime() }}</span>
        </div>
      </div>
    </div>
  </div>
  <!-- üÜï LAYOUT: GR√ÅFICA SIEMPRE VISIBLE, M√âTRICAS SOLO EN PLAY -->
  <div class="graphics-layout" *ngIf="frames.length > 0">
    <!-- üìà GR√ÅFICO 3D - SIEMPRE VISIBLE -->
  <!-- üéØ [CORRECCI√ìN 8] - CAMBIAR id POR #plot3d PARA ViewChild -->
<div class="graph-section" [class.full-width]="!isAnimating">
  <!-- üéØ [IMPORTANTE] - VERIFICAR QUE ESTE ELEMENTO EXISTA -->
  <div #plot3d class="plotly-graph-fixed" style="width: 100%; height: 500px;"></div>
</div>

    <!-- üìä PANEL DE M√âTRICAS - SOLO VISIBLE DURANTE ANIMACI√ìN -->
    <div class="metrics-panel" *ngIf="isAnimating">
      <h3>üìä M√©tricas en Tiempo Real</h3>
      <p class="metrics-subtitle">M√©tricas activas durante reproducci√≥n</p>
      
      <div class="metrics-grid">
        <!-- INFORMACI√ìN GENERAL -->
        <div class="metric-card general">
          <h4>üìà Informaci√≥n General</h4>
          <div class="metric-item">
            <label>Frames Totales:</label>
            <span>{{ frames.length }}</span>
          </div>
          <div class="metric-item">
            <label>Duraci√≥n:</label>
            <span>{{ getTotalTime() }}</span>
          </div>
          <div class="metric-item">
            <label>Puntos Activos:</label>
            <span>{{ getActivePoints() }}</span>
          </div>
          <div class="metric-item">
            <label>Frame Actual:</label>
            <span>{{ currentFrameIndex + 1 }}</span>
          </div>
        </div>

        <!-- DESPLAZAMIENTO ACTUAL -->
        <div class="metric-card displacement">
          <h4>üéØ Desplazamiento Actual</h4>
          <div class="metric-item">
            <label>Total:</label>
            <span>{{ getCurrentDisplacement() }} u</span>
          </div>
          <div class="metric-item">
            <label>En X:</label>
            <span>{{ getAxisDisplacement('x') }} u</span>
          </div>
          <div class="metric-item">
            <label>En Y:</label>
            <span>{{ getAxisDisplacement('y') }} u</span>
          </div>
          <div class="metric-item">
            <label>En Z:</label>
            <span>{{ getAxisDisplacement('z') }} u</span>
          </div>
        </div>

        <!-- VELOCIDAD Y MOVIMIENTO -->
        <div class="metric-card velocity">
          <h4>‚ö° Velocidad</h4>
          <div class="metric-item">
            <label>Promedio:</label>
            <span>{{ getAverageSpeed() }} u/s</span>
          </div>
          <div class="metric-item">
            <label>M√°xima:</label>
            <span>{{ getMaxSpeed() }} u/s</span>
          </div>
          <div class="metric-item">
            <label>Punto M√°s Activo:</label>
            <span>{{ getMostActivePoint() }}</span>
          </div>
        </div>

        <!-- RANGOS DE MOVIMIENTO -->
        <div class="metric-card ranges">
          <h4>üìè Rango de Movimiento</h4>
          <div class="metric-item">
            <label>Amplitud X:</label>
            <span>{{ getMovementRange('x') }} u</span>
          </div>
          <div class="metric-item">
            <label>Amplitud Y:</label>
            <span>{{ getMovementRange('y') }} u</span>
          </div>
          <div class="metric-item">
            <label>Amplitud Z:</label>
            <span>{{ getMovementRange('z') }} u</span>
          </div>
          <div class="metric-item">
            <label>√Årea Cubierta:</label>
            <span>{{ getCoveredArea() }} u¬≤</span>
          </div>
        </div>
      </div>
    </div>


  </div>

  <!-- ESTADO VAC√çO -->
  <div class="empty-state" *ngIf="frames.length === 0">
    <div class="empty-content">
      <div class="empty-icon">üìä</div>
      <h3>Sin datos cargados</h3>
      <p>Selecciona un archivo y haz clic en "Generar gr√°fica" para visualizar los datos y dale play para ver las metricas</p>
    </div>
  </div>
</div>